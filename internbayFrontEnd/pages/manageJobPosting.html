<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Manage Jobs - InternBay</title>
    <link href="https://cdn.jsdelivr.net/npm/bootstrap@5.3.0/dist/css/bootstrap.min.css" rel="stylesheet">
    <link href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/6.4.0/css/all.min.css" rel="stylesheet">
    <style>
        :root {
            --primary-color: #4f46e5;
            --primary-dark: #3730a3;
            --secondary-color: #f8fafc;
            --text-dark: #1e293b;
            --text-muted: #64748b;
            --success-color: #22c55e;
            --warning-color: #f59e0b;
            --danger-color: #ef4444;
        }

        * {
            margin: 0;
            padding: 0;
            box-sizing: border-box;
        }

        body {
            font-family: 'Inter', -apple-system, BlinkMacSystemFont, sans-serif;
            line-height: 1.6;
            color: var(--text-dark);
            background-color: #f8fafc;
        }

        .navbar-brand {
            font-size: 1.5rem;
            font-weight: 700;
            color: var(--primary-color) !important;
        }

        .navbar-brand i {
            margin-right: 0.5rem;
        }

        .btn-primary {
            background-color: var(--primary-color);
            border-color: var(--primary-color);
            border-radius: 8px;
            font-weight: 500;
            padding: 0.5rem 1.5rem;
            transition: all 0.3s ease;
        }

        .btn-primary:hover {
            background-color: var(--primary-dark);
            border-color: var(--primary-dark);
            transform: translateY(-1px);
            box-shadow: 0 4px 12px rgba(79, 70, 229, 0.3);
        }

        .page-header {
            background: linear-gradient(135deg, var(--primary-color) 0%, var(--primary-dark) 100%);
            color: white;
            padding: 2rem 0;
            margin-bottom: 2rem;
        }

        .stats-card {
            background: white;
            border-radius: 12px;
            padding: 1.5rem;
            box-shadow: 0 2px 10px rgba(0, 0, 0, 0.08);
            border: 1px solid #e2e8f0;
            transition: all 0.3s ease;
        }

        .stats-card:hover {
            transform: translateY(-2px);
            box-shadow: 0 4px 20px rgba(0, 0, 0, 0.1);
        }

        .stats-number {
            font-size: 2rem;
            font-weight: 700;
            margin-bottom: 0.5rem;
        }

        .stats-label {
            color: var(--text-muted);
            font-size: 0.9rem;
        }

        .job-management-card {
            background: white;
            border-radius: 12px;
            padding: 2rem;
            box-shadow: 0 2px 10px rgba(0, 0, 0, 0.08);
            border: 1px solid #e2e8f0;
        }

        .job-item {
            background: #f8fafc;
            border: 1px solid #e2e8f0;
            border-radius: 8px;
            padding: 1.5rem;
            margin-bottom: 1rem;
            transition: all 0.3s ease;
        }

        .job-item:hover {
            background: white;
            box-shadow: 0 2px 10px rgba(0, 0, 0, 0.1);
        }

        .job-title {
            font-size: 1.1rem;
            font-weight: 600;
            color: var(--text-dark);
            margin-bottom: 0.5rem;
        }

        .job-meta {
            display: flex;
            align-items: center;
            gap: 1rem;
            color: var(--text-muted);
            font-size: 0.9rem;
            margin-bottom: 1rem;
            flex-wrap: wrap;
        }

        .job-actions {
            display: flex;
            gap: 0.5rem;
            flex-wrap: wrap;
        }

        .btn-sm {
            padding: 0.375rem 0.75rem;
            font-size: 0.875rem;
        }

        .status-badge {
            padding: 0.25rem 0.75rem;
            border-radius: 20px;
            font-size: 0.75rem;
            font-weight: 500;
        }

        .status-active {
            background-color: var(--success-color);
            color: white;
        }

        .status-inactive {
            background-color: var(--text-muted);
            color: white;
        }

        .status-expired {
            background-color: var(--danger-color);
            color: white;
        }

        .filter-controls {
            background: white;
            border-radius: 8px;
            padding: 1rem;
            margin-bottom: 1.5rem;
            border: 1px solid #e2e8f0;
        }

        .loading-spinner {
            display: flex;
            justify-content: center;
            align-items: center;
            padding: 3rem;
        }

        .empty-state {
            text-align: center;
            padding: 3rem 1rem;
            color: var(--text-muted);
        }

        .applications-count {
            background: var(--primary-color);
            color: white;
            padding: 0.25rem 0.5rem;
            border-radius: 12px;
            font-size: 0.75rem;
            font-weight: 600;
        }

        .modal-header {
            background: var(--primary-color);
            color: white;
        }

        .modal-header .btn-close {
            filter: invert(1);
        }

        .form-label {
            font-weight: 600;
            color: var(--text-dark);
            margin-bottom: 0.5rem;
        }

        .form-control, .form-select {
            border-radius: 8px;
            border: 1px solid #e2e8f0;
            padding: 0.75rem 1rem;
            transition: all 0.3s ease;
        }

        .form-control:focus, .form-select:focus {
            border-color: var(--primary-color);
            box-shadow: 0 0 0 0.2rem rgba(79, 70, 229, 0.1);
        }

        /* New styles for detailed view modal */
        .job-detail-modal .modal-content {
            border-radius: 12px;
            overflow: hidden;
        }

        .job-detail-header {
            background: linear-gradient(135deg, var(--primary-color) 0%, var(--primary-dark) 100%);
            color: white;
            padding: 2rem;
        }

        .job-summary-card {
            background: white;
            border-radius: 8px;
            padding: 1.5rem;
            border: 1px solid #e2e8f0;
        }

        .job-summary-item {
            display: flex;
            align-items: flex-start;
            margin-bottom: 1.5rem;
        }

        .job-summary-item i {
            width: 20px;
            margin-right: 1rem;
            color: var(--primary-color);
            margin-top: 2px;
        }

        .requirements-list {
            padding-left: 1rem;
        }

        .requirements-list li {
            margin-bottom: 0.5rem;
            color: var(--text-muted);
        }

        .editable-list {
            border: 1px solid #e2e8f0;
            border-radius: 8px;
            padding: 0.75rem;
            min-height: 100px;
            max-height: 200px;
            overflow-y: auto;
        }

        .list-item {
            display: flex;
            align-items: center;
            margin-bottom: 0.5rem;
            padding: 0.25rem 0.5rem;
            background: #f8fafc;
            border-radius: 4px;
        }

        .list-item input {
            border: none;
            background: transparent;
            flex-grow: 1;
            outline: none;
        }

        .add-item-btn {
            background: #f8fafc;
            border: 1px dashed var(--primary-color);
            color: var(--primary-color);
            border-radius: 4px;
            padding: 0.5rem 1rem;
            cursor: pointer;
            text-align: center;
            margin-top: 0.5rem;
            transition: all 0.3s ease;
        }

        .add-item-btn:hover {
            background: var(--primary-color);
            color: white;
        }

        @media (max-width: 768px) {
            .job-actions {
                flex-direction: column;
            }

            .job-meta {
                gap: 0.5rem;
            }
        }

        .fade-in {
            opacity: 0;
            transform: translateY(20px);
            transition: all 0.6s ease;
        }

        .fade-in.visible {
            opacity: 1;
            transform: translateY(0);
        }
    </style>
</head>
<body>
<!-- Navigation -->
<nav class="navbar navbar-expand-lg navbar-light bg-white shadow-sm">
    <div class="container">
        <a class="navbar-brand" href="main.html">
            <i class="fas fa-graduation-cap"></i>InternBay
        </a>

        <button class="navbar-toggler" type="button" data-bs-toggle="collapse" data-bs-target="#navbarNav">
            <span class="navbar-toggler-icon"></span>
        </button>

        <div class="collapse navbar-collapse" id="navbarNav">
            <ul class="navbar-nav me-auto">
                <li class="nav-item">
                    <a class="nav-link" href="findJob.html">Find Internships</a>
                </li>
                <li class="nav-item dropdown">
                    <a class="nav-link dropdown-toggle active" href="#" id="jobDropdown" role="button" data-bs-toggle="dropdown" aria-expanded="false">
                        Post Job
                    </a>
                    <ul class="dropdown-menu" aria-labelledby="jobDropdown">
                        <li><a class="dropdown-item" href="jobPosting.html">
                            <i class="fas fa-plus me-2"></i>Post Job
                        </a></li>
                        <li><a class="dropdown-item active" href="manageJobPosting.html">
                            <i class="fas fa-cog me-2"></i>Manage Jobs
                        </a></li>
                    </ul>
                </li>
                <li class="nav-item">
                    <a class="nav-link" href="aboutUs.html">About Us</a>
                </li>
                <li class="nav-item">
                    <a class="nav-link" href="contactUs.html">Contact Us</a>
                </li>
                <li class="nav-item">
                    <a class="nav-link" href="resumeChecker.html">Resume Checker</a>
                </li>
            </ul>

            <div class="d-flex gap-2">
                <button class="btn btn-outline-primary">
                    <i class="fas fa-user me-1"></i>Dashboard
                </button>
            </div>
        </div>
    </div>
</nav>

<!-- Page Header -->
<div class="page-header">
    <div class="container">
        <div class="row align-items-center">
            <div class="col-lg-8">
                <h1 class="h2 mb-2">Manage Your Job Postings</h1>
                <p class="mb-0 opacity-75">Track applications and manage your job listings</p>
            </div>
            <div class="col-lg-4 text-end">
                <a href="jobPosting.html" class="btn btn-light">
                    <i class="fas fa-plus me-2"></i>Post New Job
                </a>
            </div>
        </div>
    </div>
</div>

<div class="container mb-5">
    <!-- Stats Cards -->
    <div class="row mb-4">
        <div class="col-md-3 col-sm-6 mb-3">
            <div class="stats-card">
                <div class="stats-number text-primary" id="totalJobs">-</div>
                <div class="stats-label">Total Jobs Posted</div>
            </div>
        </div>
        <div class="col-md-3 col-sm-6 mb-3">
            <div class="stats-card">
                <div class="stats-number text-success" id="activeJobs">-</div>
                <div class="stats-label">Active Jobs</div>
            </div>
        </div>
        <div class="col-md-3 col-sm-6 mb-3">
            <div class="stats-card">
                <div class="stats-number text-info" id="totalApplications">-</div>
                <div class="stats-label">Total Applications</div>
            </div>
        </div>
        <div class="col-md-3 col-sm-6 mb-3">
            <div class="stats-card">
                <div class="stats-number text-warning" id="pendingReviews">-</div>
                <div class="stats-label">Pending Reviews</div>
            </div>
        </div>
    </div>

    <!-- Filter Controls -->
    <div class="filter-controls">
        <div class="row align-items-center">
            <div class="col-md-6">
                <div class="input-group">
                    <span class="input-group-text">
                        <i class="fas fa-search"></i>
                    </span>
                    <input type="text" class="form-control" id="searchJobs" placeholder="Search your jobs...">
                </div>
            </div>
            <div class="col-md-3">
                <select class="form-select" id="statusFilter">
                    <option value="">All Status</option>
                    <option value="active">Active</option>
                    <option value="inactive">Inactive</option>
                </select>
            </div>
            <div class="col-md-3">
                <select class="form-select" id="sortBy">
                    <option value="newest">Newest First</option>
                    <option value="oldest">Oldest First</option>
                    <option value="title">Title A-Z</option>
                    <option value="applications">Most Applications</option>
                </select>
            </div>
        </div>
    </div>

    <!-- Job Management Card -->
    <div class="job-management-card">
        <div class="d-flex justify-content-between align-items-center mb-4">
            <h4 class="mb-0">Your Job Postings</h4>
            <button class="btn btn-outline-primary" onclick="refreshJobs()">
                <i class="fas fa-sync me-1"></i>Refresh
            </button>
        </div>

        <!-- Jobs List -->
        <div id="jobsList">
            <div class="loading-spinner">
                <div class="spinner-border text-primary" role="status">
                    <span class="visually-hidden">Loading...</span>
                </div>
            </div>
        </div>

        <!-- Pagination -->
        <nav aria-label="Job management pagination" id="paginationContainer" style="display: none;">
            <ul class="pagination justify-content-center" id="pagination">
                <!-- Pagination will be generated here -->
            </ul>
        </nav>
    </div>
</div>

<!-- Job Details Modal -->
<div class="modal fade job-detail-modal" id="jobDetailsModal" tabindex="-1">
    <div class="modal-dialog modal-dialog-centered modal-dialog-scrollable modal-xl">
        <div class="modal-content border-0 shadow-lg">
            <div class="job-detail-header">
                <div class="d-flex justify-content-between align-items-start">
                    <div>
                        <h3 class="mb-2" id="modalJobTitle">Job Title</h3>
                        <p class="mb-0 opacity-75">Posted by: <span id="modalCompany">Company Name</span></p>
                    </div>
                    <button type="button" class="btn-close btn-close-white" data-bs-dismiss="modal"></button>
                </div>
            </div>

            <div class="modal-body p-0">
                <div class="row g-0">
                    <div class="col-lg-8 p-4">
                        <div class="mb-4">
                            <h6 class="fw-bold mb-3">Job Description</h6>
                            <div id="modalJobDescription">
                                <!-- Job description will be inserted here -->
                            </div>
                        </div>

                        <div class="mb-4" id="responsibilitiesSection">
                            <h6 class="fw-bold mb-3">Responsibilities</h6>
                            <ul class="requirements-list" id="modalResponsibilities">
                                <!-- Job responsibilities will be inserted here -->
                            </ul>
                        </div>

                        <div class="mb-4" id="requirementsSection">
                            <h6 class="fw-bold mb-3">Requirements</h6>
                            <ul class="requirements-list" id="modalRequirements">
                                <!-- Job requirements will be inserted here -->
                            </ul>
                        </div>
                    </div>

                    <div class="col-lg-4 bg-light p-4">
                        <div class="job-summary-card">
                            <h6 class="fw-bold mb-3">Job Summary</h6>

                            <div class="job-summary-item">
                                <i class="fas fa-map-marker-alt"></i>
                                <div>
                                    <strong>Location</strong><br>
                                    <span class="text-muted" id="modalLocation">Location</span>
                                </div>
                            </div>

                            <div class="job-summary-item">
                                <i class="fas fa-briefcase"></i>
                                <div>
                                    <strong>Job Type</strong><br>
                                    <span class="text-muted" id="modalJobType">Job Type</span>
                                </div>
                            </div>

                            <div class="job-summary-item">
                                <i class="fas fa-dollar-sign"></i>
                                <div>
                                    <strong>Salary</strong><br>
                                    <span class="text-muted" id="modalSalary">Salary</span>
                                </div>
                            </div>

                            <div class="job-summary-item">
                                <i class="fas fa-building"></i>
                                <div>
                                    <strong>Company</strong><br>
                                    <span class="text-muted" id="modalCompanyName">Company</span>
                                </div>
                            </div>

                            <div class="job-summary-item mb-4">
                                <i class="fas fa-calendar"></i>
                                <div>
                                    <strong>Date Posted</strong><br>
                                    <span class="text-muted" id="modalDatePosted">Date</span>
                                </div>
                            </div>

                            <button type="button" class="btn btn-primary w-100 py-2 mb-3" onclick="editJobFromModal()" id="editFromModalButton">
                                <i class="fas fa-edit me-2"></i>Edit Job
                            </button>

                            <button type="button" class="btn btn-outline-info w-100 mb-2" onclick="viewApplicationsFromModal()" id="viewAppsButton">
                                <i class="fas fa-users me-2"></i>View Applications
                            </button>

                            <button type="button" class="btn btn-outline-secondary w-100 mb-2" onclick="toggleJobStatusFromModal()" id="toggleStatusButton">
                                <i class="fas fa-pause me-2"></i>Pause Job
                            </button>

                            <button type="button" class="btn btn-outline-danger w-100" onclick="deleteJobFromModal()" id="deleteFromModalButton">
                                <i class="fas fa-trash me-2"></i>Delete Job
                            </button>
                        </div>
                    </div>
                </div>
            </div>
        </div>
    </div>
</div>

<!-- Edit Job Modal -->
<div class="modal fade" id="editJobModal" tabindex="-1">
    <div class="modal-dialog modal-xl">
        <div class="modal-content">
            <div class="modal-header">
                <h5 class="modal-title">Edit Job Posting</h5>
                <button type="button" class="btn-close" data-bs-dismiss="modal"></button>
            </div>
            <div class="modal-body">
                <form id="editJobForm">
                    <input type="hidden" id="editJobId">

                    <div class="row g-3 mb-3">
                        <div class="col-md-8">
                            <label for="editJobTitle" class="form-label">Job Title</label>
                            <input type="text" class="form-control" id="editJobTitle" required>
                        </div>
                        <div class="col-md-4">
                            <label for="editJobType" class="form-label">Job Type</label>
                            <select class="form-select" id="editJobType" required>
                                <option value="FULLTIME">Full Time</option>
                                <option value="PARTTIME">Part Time</option>
                                <option value="INTERNSHIP">Internship</option>
                                <option value="CONTRACT">Contract</option>
                                <option value="REMOTE">Remote</option>
                            </select>
                        </div>
                    </div>

                    <div class="row g-3 mb-3">
                        <div class="col-md-6">
                            <label for="editLocation" class="form-label">Location</label>
                            <input type="text" class="form-control" id="editLocation" required>
                        </div>
                        <div class="col-md-6">
                            <label for="editSalary" class="form-label">Salary ($/hour)</label>
                            <input type="number" class="form-control" id="editSalary" min="1" step="0.01" required>
                        </div>
                    </div>

                    <div class="mb-3">
                        <label for="editJobDescription" class="form-label">Job Description</label>
                        <textarea class="form-control" id="editJobDescription" rows="5" required></textarea>
                    </div>

                    <div class="row g-3 mb-3">
                        <div class="col-md-6">
                            <label class="form-label">Responsibilities</label>
                            <div class="editable-list" id="editResponsibilitiesList">
                                <!-- Responsibilities will be populated here -->
                            </div>
                            <div class="add-item-btn" onclick="addResponsibility()">
                                <i class="fas fa-plus me-1"></i>Add Responsibility
                            </div>
                        </div>
                        <div class="col-md-6">
                            <label class="form-label">Requirements</label>
                            <div class="editable-list" id="editRequirementsList">
                                <!-- Requirements will be populated here -->
                            </div>
                            <div class="add-item-btn" onclick="addRequirement()">
                                <i class="fas fa-plus me-1"></i>Add Requirement
                            </div>
                        </div>
                    </div>
                </form>
            </div>
            <div class="modal-footer">
                <button type="button" class="btn btn-secondary" data-bs-dismiss="modal">Cancel</button>
                <button type="button" class="btn btn-primary" onclick="updateJob()">
                    <i class="fas fa-save me-1"></i>Save Changes
                </button>
            </div>
        </div>
    </div>
</div>

<!-- Delete Confirmation Modal -->
<div class="modal fade" id="deleteConfirmModal" tabindex="-1">
    <div class="modal-dialog">
        <div class="modal-content">
            <div class="modal-header bg-danger text-white">
                <h5 class="modal-title">Confirm Deletion</h5>
                <button type="button" class="btn-close" data-bs-dismiss="modal"></button>
            </div>
            <div class="modal-body">
                <p>Are you sure you want to delete this job posting?</p>
                <p class="text-muted small">This action cannot be undone. All associated applications will also be removed.</p>
                <div class="alert alert-warning">
                    <i class="fas fa-exclamation-triangle me-2"></i>
                    Job: <strong id="deleteJobTitle"></strong>
                </div>
            </div>
            <div class="modal-footer">
                <button type="button" class="btn btn-secondary" data-bs-dismiss="modal">Cancel</button>
                <button type="button" class="btn btn-danger" onclick="confirmDeleteJob()">
                    <i class="fas fa-trash me-1"></i>Delete Job
                </button>
            </div>
        </div>
    </div>
</div>

<!-- Applications Modal -->
<div class="modal fade" id="applicationsModal" tabindex="-1">
    <div class="modal-dialog modal-xl">
        <div class="modal-content">
            <div class="modal-header">
                <h5 class="modal-title">Job Applications</h5>
                <button type="button" class="btn-close" data-bs-dismiss="modal"></button>
            </div>
            <div class="modal-body">
                <div class="mb-3">
                    <h6 id="applicationsJobTitle"></h6>
                    <p class="text-muted" id="applicationsJobMeta"></p>
                </div>

                <div id="applicationsList">
                    <div class="loading-spinner">
                        <div class="spinner-border text-primary" role="status">
                            <span class="visually-hidden">Loading applications...</span>
                        </div>
                    </div>
                </div>
            </div>
        </div>
    </div>
</div>

<script src="https://cdn.jsdelivr.net/npm/bootstrap@5.3.0/dist/js/bootstrap.bundle.min.js"></script>
<script src="https://code.jquery.com/jquery-3.6.0.min.js"></script>
<script>
    let currentJobs = [];
    let currentPage = 1;
    let totalPages = 1;
    let isLoading = false;
    let employerProfile = null;
    let jobToDelete = null;
    let selectedJob = null; // For detailed view modal

    // Initialize page
    document.addEventListener('DOMContentLoaded', function() {
        checkAuthAndRedirect();
        setupEventListeners();
        loadEmployerProfile();
    });

    // Check authentication and redirect if needed
    function checkAuthAndRedirect() {
        const token = sessionStorage.getItem('authToken');
        const userRole = sessionStorage.getItem('userRole');

        if (!token || userRole !== 'EMPLOYEE') {
            showNotification('You must be logged in as an employer to access this page', 'error');
            setTimeout(() => {
                window.location.href = 'main.html';
            }, 2000);
            return;
        }

        updateNavbarForLoggedInUser();
    }

    // Setup event listeners
    function setupEventListeners() {
        document.getElementById('searchJobs').addEventListener('input', debounce(filterJobs, 300));
        document.getElementById('statusFilter').addEventListener('change', filterJobs);
        document.getElementById('sortBy').addEventListener('change', filterJobs);
    }

    // Load employer profile
    async function loadEmployerProfile() {
        const token = sessionStorage.getItem('authToken');

        try {
            const response = await fetch('http://localhost:8080/api/v1/employer/profile', {
                method: 'GET',
                headers: {
                    'Authorization': `Bearer ${token}`,
                    'Content-Type': 'application/json'
                }
            });

            if (response.ok) {
                const data = await response.json();
                employerProfile = data.data;
                loadJobs();
                loadStats();
            } else {
                showNotification('Please complete your employer profile first', 'warning');
                setTimeout(() => {
                    window.location.href = 'employerProfile.html';
                }, 2000);
            }
        } catch (error) {
            console.error('Error loading employer profile:', error);
            showNotification('Error loading profile', 'error');
        }
    }

    // Load jobs
    async function loadJobs(page = 1) {
        if (isLoading || !employerProfile) return;

        isLoading = true;
        showLoadingState();

        const token = sessionStorage.getItem('authToken');

        try {
            const params = new URLSearchParams({
                page: page - 1,
                size: 10,
                sort: getSortParameter()
            });

            const response = await fetch(`http://localhost:8080/api/v1/jobs/employer/${employerProfile.employerId}?${params}`, {
                method: 'GET',
                headers: {
                    'Authorization': `Bearer ${token}`,
                    'Content-Type': 'application/json'
                }
            });

            const data = await response.json();

            if (response.ok) {
                currentJobs = data.data.content;
                currentPage = data.data.number + 1;
                totalPages = data.data.totalPages;

                displayJobs();
                updatePagination();
            } else {
                showError('Error loading jobs: ' + data.message);
            }
        } catch (error) {
            console.error('Error loading jobs:', error);
            showError('Error loading jobs. Please try again.');
        } finally {
            isLoading = false;
        }
    }

    // Load statistics
    async function loadStats() {
        const token = sessionStorage.getItem('authToken');

        try {
            const response = await fetch(`http://localhost:8080/api/v1/jobs/employer/${employerProfile.employerId}/stats`, {
                method: 'GET',
                headers: {
                    'Authorization': `Bearer ${token}`,
                    'Content-Type': 'application/json'
                }
            });

            if (response.ok) {
                const data = await response.json();
                updateStats(data.data);
            }
        } catch (error) {
            console.error('Error loading stats:', error);
            // Set default values if stats endpoint fails
            updateStats({
                totalJobs: currentJobs.length,
                activeJobs: currentJobs.length,
                totalApplications: 0,
                pendingReviews: 0
            });
        }
    }

    // Update statistics display
    function updateStats(stats) {
        document.getElementById('totalJobs').textContent = stats.totalJobs || 0;
        document.getElementById('activeJobs').textContent = stats.activeJobs || 0;
        document.getElementById('totalApplications').textContent = stats.totalApplications || 0;
        document.getElementById('pendingReviews').textContent = stats.pendingReviews || 0;
    }

    // Get sort parameter
    function getSortParameter() {
        const sortBy = document.getElementById('sortBy').value;
        switch (sortBy) {
            case 'newest':
                return 'datePosted,desc';
            case 'oldest':
                return 'datePosted,asc';
            case 'title':
                return 'title,asc';
            case 'applications':
                return 'applicationCount,desc';
            default:
                return 'datePosted,desc';
        }
    }

    // Display jobs
    function displayJobs() {
        const jobsList = document.getElementById('jobsList');
        const filteredJobs = getFilteredJobs();

        if (filteredJobs.length === 0) {
            jobsList.innerHTML = `
                <div class="empty-state">
                    <i class="fas fa-briefcase fa-3x text-muted mb-3"></i>
                    <h4>No Jobs Found</h4>
                    <p>You haven't posted any jobs yet or no jobs match your filters.</p>
                    <a href="jobPosting.html" class="btn btn-primary">
                        <i class="fas fa-plus me-2"></i>Post Your First Job
                    </a>
                </div>
            `;
            return;
        }

        let html = '';
        filteredJobs.forEach(job => {
            html += createJobItem(job);
        });

        jobsList.innerHTML = html;

        // Add fade-in animation
        setTimeout(() => {
            document.querySelectorAll('.fade-in').forEach(el => {
                el.classList.add('visible');
            });
        }, 100);
    }

    // Create job item HTML
    function createJobItem(job) {
        const formattedDate = formatDate(job.datePosted);
        const salary = job.salaryPerHour ? `${job.salaryPerHour}/hr` : 'Negotiable';
        const applicationCount = job.applicationCount || 0;

        return `
            <div class="job-item fade-in">
                <div class="d-flex justify-content-between align-items-start">
                    <div class="flex-grow-1">
                        <div class="d-flex align-items-center mb-2">
                            <h5 class="job-title me-3">${job.title}</h5>
                            <span class="status-badge status-active">Active</span>
                            ${applicationCount > 0 ? `<span class="applications-count ms-2">${applicationCount} applications</span>` : ''}
                        </div>

                        <div class="job-meta">
                            <span><i class="fas fa-building me-1"></i>${job.companyName || 'Company'}</span>
                            <span><i class="fas fa-map-marker-alt me-1"></i>${job.location}</span>
                            <span><i class="fas fa-clock me-1"></i>${formatJobType(job.jobType)}</span>
                            <span><i class="fas fa-dollar-sign me-1"></i>${salary}</span>
                            <span><i class="fas fa-calendar me-1"></i>${formattedDate}</span>
                        </div>

                        <p class="text-muted mb-3 small">${truncateText(job.jobOverview, 150)}</p>
                    </div>
                </div>

                <div class="job-actions">
                    <button class="btn btn-primary btn-sm" onclick="showJobDetails(${job.jobId})">
                        <i class="fas fa-eye me-1"></i>View Details
                    </button>
                    <button class="btn btn-outline-info btn-sm" onclick="viewApplications(${job.jobId}, '${job.title}')">
                        <i class="fas fa-users me-1"></i>Applications (${applicationCount})
                    </button>
                    <button class="btn btn-outline-warning btn-sm" onclick="editJob(${job.jobId})">
                        <i class="fas fa-edit me-1"></i>Edit
                    </button>
                    <button class="btn btn-outline-secondary btn-sm" onclick="toggleJobStatus(${job.jobId})">
                        <i class="fas fa-pause me-1"></i>Pause
                    </button>
                    <button class="btn btn-outline-danger btn-sm" onclick="deleteJob(${job.jobId}, '${job.title}')">
                        <i class="fas fa-trash me-1"></i>Delete
                    </button>
                </div>
            </div>
        `;
    }

    // Show job details in modal
    async function showJobDetails(jobId) {
        selectedJob = currentJobs.find(job => job.jobId === jobId);
        if (!selectedJob) return;

        try {
            const token = sessionStorage.getItem('authToken');
            const response = await fetch(`http://localhost:8080/api/v1/jobs/${jobId}`, {
                method: 'GET',
                headers: {
                    'Authorization': `Bearer ${token}`,
                    'Content-Type': 'application/json'
                }
            });

            const data = await response.json();

            if (response.ok) {
                const job = data.data;
                selectedJob = job;
                populateJobModal(job);
                new bootstrap.Modal(document.getElementById('jobDetailsModal')).show();
            } else {
                showNotification('Error loading job details', 'error');
            }
        } catch (error) {
            console.error('Error loading job details:', error);
            showNotification('Error loading job details', 'error');
        }
    }

    // Populate job modal
    function populateJobModal(job) {
        document.getElementById('modalJobTitle').textContent = job.title;
        document.getElementById('modalCompany').textContent = job.companyName || 'Company';
        document.getElementById('modalLocation').textContent = job.location;
        document.getElementById('modalJobType').textContent = formatJobType(job.jobType);
        document.getElementById('modalSalary').textContent = job.salaryPerHour ? `${job.salaryPerHour}/hr` : 'Negotiable';
        document.getElementById('modalCompanyName').textContent = job.companyName || 'Company';
        document.getElementById('modalDatePosted').textContent = formatDate(job.datePosted);
        document.getElementById('modalJobDescription').innerHTML = job.jobOverview ? job.jobOverview.replace(/\n/g, '<br>') : 'No description available';

        // Populate responsibilities
        const responsibilitiesContainer = document.getElementById('modalResponsibilities');
        const responsibilitiesSection = document.getElementById('responsibilitiesSection');

        if (job.responsibilities && job.responsibilities.length > 0) {
            responsibilitiesContainer.innerHTML = '';
            job.responsibilities.forEach(responsibility => {
                const li = document.createElement('li');
                li.textContent = responsibility;
                responsibilitiesContainer.appendChild(li);
            });
            responsibilitiesSection.style.display = 'block';
        } else {
            responsibilitiesSection.style.display = 'none';
        }

        // Populate requirements
        const requirementsContainer = document.getElementById('modalRequirements');
        const requirementsSection = document.getElementById('requirementsSection');

        if (job.requirements && job.requirements.length > 0) {
            requirementsContainer.innerHTML = '';
            job.requirements.forEach(requirement => {
                const li = document.createElement('li');
                li.textContent = requirement;
                requirementsContainer.appendChild(li);
            });
            requirementsSection.style.display = 'block';
        } else {
            requirementsSection.style.display = 'none';
        }

        // Update button counts
        const applicationCount = job.applicationCount || 0;
        document.getElementById('viewAppsButton').innerHTML = `<i class="fas fa-users me-2"></i>View Applications (${applicationCount})`;
    }

    // Modal action functions
    function editJobFromModal() {
        if (selectedJob) {
            bootstrap.Modal.getInstance(document.getElementById('jobDetailsModal')).hide();
            setTimeout(() => {
                editJob(selectedJob.jobId);
            }, 300);
        }
    }

    function viewApplicationsFromModal() {
        if (selectedJob) {
            bootstrap.Modal.getInstance(document.getElementById('jobDetailsModal')).hide();
            setTimeout(() => {
                viewApplications(selectedJob.jobId, selectedJob.title);
            }, 300);
        }
    }

    function toggleJobStatusFromModal() {
        if (selectedJob) {
            toggleJobStatus(selectedJob.jobId);
        }
    }

    function deleteJobFromModal() {
        if (selectedJob) {
            bootstrap.Modal.getInstance(document.getElementById('jobDetailsModal')).hide();
            setTimeout(() => {
                deleteJob(selectedJob.jobId, selectedJob.title);
            }, 300);
        }
    }

    // Show loading state
    function showLoadingState() {
        document.getElementById('jobsList').innerHTML = `
            <div class="loading-spinner">
                <div class="spinner-border text-primary" role="status">
                    <span class="visually-hidden">Loading...</span>
                </div>
            </div>
        `;
    }

    // Show error state
    function showError(message) {
        document.getElementById('jobsList').innerHTML = `
            <div class="empty-state">
                <i class="fas fa-exclamation-triangle fa-3x text-danger mb-3"></i>
                <h4>Error Loading Jobs</h4>
                <p>${message}</p>
                <button class="btn btn-primary" onclick="refreshJobs()">Try Again</button>
            </div>
        `;
    }

    // Get filtered jobs
    function getFilteredJobs() {
        const searchTerm = document.getElementById('searchJobs').value.toLowerCase();
        const statusFilter = document.getElementById('statusFilter').value;

        return currentJobs.filter(job => {
            const matchesSearch = !searchTerm ||
                job.title.toLowerCase().includes(searchTerm) ||
                job.location.toLowerCase().includes(searchTerm);

            const matchesStatus = !statusFilter ||
                (statusFilter === 'active' && true) || // Assuming all fetched jobs are active
                (statusFilter === 'inactive' && false);

            return matchesSearch && matchesStatus;
        });
    }

    // Filter jobs
    function filterJobs() {
        displayJobs();
    }

    // View applications
    async function viewApplications(jobId, jobTitle) {
        const token = sessionStorage.getItem('authToken');

        document.getElementById('applicationsJobTitle').textContent = jobTitle;
        document.getElementById('applicationsList').innerHTML = `
            <div class="loading-spinner">
                <div class="spinner-border text-primary" role="status">
                    <span class="visually-hidden">Loading applications...</span>
                </div>
            </div>
        `;

        new bootstrap.Modal(document.getElementById('applicationsModal')).show();

        try {
            const response = await fetch(`http://localhost:8080/api/v1/jobs/${jobId}/applications`, {
                method: 'GET',
                headers: {
                    'Authorization': `Bearer ${token}`,
                    'Content-Type': 'application/json'
                }
            });

            const data = await response.json();

            if (response.ok) {
                displayApplications(data.data);
            } else {
                document.getElementById('applicationsList').innerHTML = `
                    <div class="text-center py-4">
                        <p class="text-muted">Error loading applications</p>
                    </div>
                `;
            }
        } catch (error) {
            console.error('Error loading applications:', error);
            document.getElementById('applicationsList').innerHTML = `
                <div class="text-center py-4">
                    <p class="text-muted">Error loading applications</p>
                </div>
            `;
        }
    }

    // Display applications
    function displayApplications(applications) {
        const applicationsList = document.getElementById('applicationsList');

        if (applications.length === 0) {
            applicationsList.innerHTML = `
                <div class="text-center py-4">
                    <i class="fas fa-inbox fa-2x text-muted mb-3"></i>
                    <p class="text-muted">No applications yet</p>
                </div>
            `;
            return;
        }

        let html = '';
        applications.forEach(application => {
            html += `
                <div class="border rounded p-3 mb-3">
                    <div class="d-flex justify-content-between align-items-start">
                        <div>
                            <h6>${application.candidateName}</h6>
                            <p class="text-muted small mb-2">${application.candidateEmail}</p>
                            <p class="text-muted small">Applied: ${formatDate(application.appliedDate)}</p>
                        </div>
                        <div>
                            <span class="badge bg-primary">${application.status}</span>
                        </div>
                    </div>
                    <div class="mt-2">
                        <button class="btn btn-sm btn-outline-primary me-2" onclick="viewCandidate(${application.candidateId})">
                            <i class="fas fa-user me-1"></i>View Profile
                        </button>
                        ${application.resumeUrl ?
                `<button class="btn btn-sm btn-outline-info me-2" onclick="viewResume('${application.resumeUrl}')">
                                <i class="fas fa-file-pdf me-1"></i>View Resume
                            </button>` : ''
            }
                        <button class="btn btn-sm btn-outline-success me-2" onclick="updateApplicationStatus(${application.applicationId}, 'ACCEPTED')">
                            <i class="fas fa-check me-1"></i>Accept
                        </button>
                        <button class="btn btn-sm btn-outline-danger" onclick="updateApplicationStatus(${application.applicationId}, 'REJECTED')">
                            <i class="fas fa-times me-1"></i>Reject
                        </button>
                    </div>
                </div>
            `;
        });

        applicationsList.innerHTML = html;
    }

    // Edit job functions
    async function editJob(jobId) {
        const job = currentJobs.find(j => j.jobId === jobId);
        if (!job) {
            // Fetch job details if not found in current list
            try {
                const token = sessionStorage.getItem('authToken');
                const response = await fetch(`http://localhost:8080/api/v1/jobs/${jobId}`, {
                    method: 'GET',
                    headers: {
                        'Authorization': `Bearer ${token}`,
                        'Content-Type': 'application/json'
                    }
                });

                if (response.ok) {
                    const data = await response.json();
                    populateEditForm(data.data);
                } else {
                    showNotification('Error loading job details', 'error');
                    return;
                }
            } catch (error) {
                console.error('Error loading job details:', error);
                showNotification('Error loading job details', 'error');
                return;
            }
        } else {
            populateEditForm(job);
        }

        new bootstrap.Modal(document.getElementById('editJobModal')).show();
    }

    // Populate edit form
    function populateEditForm(job) {
        document.getElementById('editJobId').value = job.jobId;
        document.getElementById('editJobTitle').value = job.title;
        document.getElementById('editJobType').value = job.jobType;
        document.getElementById('editLocation').value = job.location;
        document.getElementById('editSalary').value = job.salaryPerHour;
        document.getElementById('editJobDescription').value = job.jobOverview;

        // Populate responsibilities
        const responsibilitiesList = document.getElementById('editResponsibilitiesList');
        responsibilitiesList.innerHTML = '';
        if (job.responsibilities && job.responsibilities.length > 0) {
            job.responsibilities.forEach(responsibility => {
                addEditableItem(responsibilitiesList, responsibility, 'responsibility');
            });
        }

        // Populate requirements
        const requirementsList = document.getElementById('editRequirementsList');
        requirementsList.innerHTML = '';
        if (job.requirements && job.requirements.length > 0) {
            job.requirements.forEach(requirement => {
                addEditableItem(requirementsList, requirement, 'requirement');
            });
        }
    }

    // Add editable item to list
    function addEditableItem(container, text = '', type = 'item') {
        const itemDiv = document.createElement('div');
        itemDiv.className = 'list-item';
        itemDiv.innerHTML = `
            <input type="text" value="${text}" placeholder="Enter ${type}..." class="form-control-plaintext">
            <button type="button" class="btn btn-sm btn-outline-danger" onclick="removeEditableItem(this)">
                <i class="fas fa-times"></i>
            </button>
        `;
        container.appendChild(itemDiv);
    }

    // Remove editable item
    function removeEditableItem(button) {
        button.parentElement.remove();
    }

    // Add responsibility
    function addResponsibility() {
        const container = document.getElementById('editResponsibilitiesList');
        addEditableItem(container, '', 'responsibility');
    }

    // Add requirement
    function addRequirement() {
        const container = document.getElementById('editRequirementsList');
        addEditableItem(container, '', 'requirement');
    }

    // Get list values
    function getListValues(containerId) {
        const container = document.getElementById(containerId);
        const inputs = container.querySelectorAll('input');
        const values = [];
        inputs.forEach(input => {
            if (input.value.trim()) {
                values.push(input.value.trim());
            }
        });
        return values;
    }

    // Update job
    async function updateJob() {
        const token = sessionStorage.getItem('authToken');
        const jobId = document.getElementById('editJobId').value;

        const responsibilities = getListValues('editResponsibilitiesList');
        const requirements = getListValues('editRequirementsList');

        const jobData = {
            title: document.getElementById('editJobTitle').value.trim(),
            location: document.getElementById('editLocation').value.trim(),
            jobType: document.getElementById('editJobType').value,
            salaryPerHour: parseFloat(document.getElementById('editSalary').value),
            jobOverview: document.getElementById('editJobDescription').value.trim(),
            responsibilities: responsibilities,
            requirements: requirements
        };

        try {
            const response = await fetch(`http://localhost:8080/api/v1/jobs/${jobId}`, {
                method: 'PUT',
                headers: {
                    'Authorization': `Bearer ${token}`,
                    'Content-Type': 'application/json'
                },
                body: JSON.stringify(jobData)
            });

            if (response.ok) {
                showNotification('Job updated successfully!', 'success');
                bootstrap.Modal.getInstance(document.getElementById('editJobModal')).hide();
                refreshJobs();
            } else {
                const data = await response.json();
                showNotification(data.message || 'Failed to update job', 'error');
            }
        } catch (error) {
            console.error('Error updating job:', error);
            showNotification('Error updating job', 'error');
        }
    }

    // Delete job
    function deleteJob(jobId, jobTitle) {
        jobToDelete = jobId;
        document.getElementById('deleteJobTitle').textContent = jobTitle;
        new bootstrap.Modal(document.getElementById('deleteConfirmModal')).show();
    }

    // Confirm delete job
    async function confirmDeleteJob() {
        if (!jobToDelete) return;

        const token = sessionStorage.getItem('authToken');

        try {
            const response = await fetch(`http://localhost:8080/api/v1/jobs/${jobToDelete}`, {
                method: 'DELETE',
                headers: {
                    'Authorization': `Bearer ${token}`,
                    'Content-Type': 'application/json'
                }
            });

            if (response.ok) {
                showNotification('Job deleted successfully!', 'success');
                bootstrap.Modal.getInstance(document.getElementById('deleteConfirmModal')).hide();
                refreshJobs();
            } else {
                const data = await response.json();
                showNotification(data.message || 'Failed to delete job', 'error');
            }
        } catch (error) {
            console.error('Error deleting job:', error);
            showNotification('Error deleting job', 'error');
        } finally {
            jobToDelete = null;
        }
    }

    // Toggle job status
    async function toggleJobStatus(jobId) {
        const token = sessionStorage.getItem('authToken');

        try {
            const response = await fetch(`http://localhost:8080/api/v1/jobs/${jobId}/toggle-status`, {
                method: 'PATCH',
                headers: {
                    'Authorization': `Bearer ${token}`,
                    'Content-Type': 'application/json'
                }
            });

            if (response.ok) {
                showNotification('Job status updated!', 'success');
                refreshJobs();
            } else {
                const data = await response.json();
                showNotification(data.message || 'Failed to update job status', 'error');
            }
        } catch (error) {
            console.error('Error updating job status:', error);
            showNotification('Error updating job status', 'error');
        }
    }

    // Update application status
    async function updateApplicationStatus(applicationId, status) {
        const token = sessionStorage.getItem('authToken');

        try {
            const response = await fetch(`http://localhost:8080/api/v1/applications/${applicationId}/status`, {
                method: 'PATCH',
                headers: {
                    'Authorization': `Bearer ${token}`,
                    'Content-Type': 'application/json'
                },
                body: JSON.stringify({ status: status })
            });

            if (response.ok) {
                showNotification(`Application ${status.toLowerCase()}!`, 'success');
                // Refresh the applications view
                const modal = bootstrap.Modal.getInstance(document.getElementById('applicationsModal'));
                if (modal) {
                    const jobTitle = document.getElementById('applicationsJobTitle').textContent;
                    // Find the job ID from current jobs
                    const job = currentJobs.find(j => j.title === jobTitle);
                    if (job) {
                        viewApplications(job.jobId, jobTitle);
                    }
                }
            } else {
                const data = await response.json();
                showNotification(data.message || 'Failed to update application', 'error');
            }
        } catch (error) {
            console.error('Error updating application status:', error);
            showNotification('Error updating application status', 'error');
        }
    }

    // View candidate profile
    function viewCandidate(candidateId) {
        window.open(`candidateProfile.html?id=${candidateId}`, '_blank');
    }

    // View resume
    function viewResume(resumeUrl) {
        window.open(resumeUrl, '_blank');
    }

    // Update pagination
    function updatePagination() {
        const paginationContainer = document.getElementById('paginationContainer');
        const pagination = document.getElementById('pagination');

        if (totalPages <= 1) {
            paginationContainer.style.display = 'none';
            return;
        }

        paginationContainer.style.display = 'block';
        let html = '';

        // Previous button
        html += `
            <li class="page-item ${currentPage === 1 ? 'disabled' : ''}">
                <a class="page-link" href="#" onclick="changePage(${currentPage - 1})" tabindex="-1">Previous</a>
            </li>
        `;

        // Page numbers
        const startPage = Math.max(1, currentPage - 2);
        const endPage = Math.min(totalPages, currentPage + 2);

        for (let i = startPage; i <= endPage; i++) {
            html += `
                <li class="page-item ${currentPage === i ? 'active' : ''}">
                    <a class="page-link" href="#" onclick="changePage(${i})">${i}</a>
                </li>
            `;
        }

        // Next button
        html += `
            <li class="page-item ${currentPage === totalPages ? 'disabled' : ''}">
                <a class="page-link" href="#" onclick="changePage(${currentPage + 1})">Next</a>
            </li>
        `;

        pagination.innerHTML = html;
    }

    // Change page
    function changePage(page) {
        if (page < 1 || page > totalPages || page === currentPage || isLoading) {
            return;
        }
        loadJobs(page);
        window.scrollTo({ top: 0, behavior: 'smooth' });
    }

    // Refresh jobs
    function refreshJobs() {
        currentPage = 1;
        loadJobs(1);
        loadStats();
    }

    // Update navbar for logged in user
    function updateNavbarForLoggedInUser() {
        const navbar = document.querySelector('.navbar .container');
        if (!navbar) return;

        const navbarCollapse = navbar.querySelector('.navbar-collapse');
        if (!navbarCollapse) return;

        navbarCollapse.innerHTML = `
            <ul class="navbar-nav me-auto">
                <li class="nav-item">
                    <a class="nav-link" href="findJob.html">Find Internships</a>
                </li>
                <li class="nav-item dropdown">
                    <a class="nav-link dropdown-toggle active" href="#" id="jobDropdown" role="button" data-bs-toggle="dropdown" aria-expanded="false">
                        Post Job
                    </a>
                    <ul class="dropdown-menu" aria-labelledby="jobDropdown">
                        <li><a class="dropdown-item" href="jobPosting.html">
                            <i class="fas fa-plus me-2"></i>Post Job
                        </a></li>
                        <li><a class="dropdown-item active" href="manageJobPosting.html">
                            <i class="fas fa-cog me-2"></i>Manage Jobs
                        </a></li>
                    </ul>
                </li>
                <li class="nav-item">
                    <a class="nav-link" href="aboutUs.html">About Us</a>
                </li>
                <li class="nav-item">
                    <a class="nav-link" href="contactUs.html">Contact Us</a>
                </li>
                <li class="nav-item">
                    <a class="nav-link" href="resumeChecker.html">Resume Checker</a>
                </li>
            </ul>
            <div class="d-flex gap-2">
                <button class="btn btn-outline-primary" onclick="showNotifications()">
                    <i class="fas fa-bell me-1"></i>Notifications
                </button>
                <div class="dropdown">
                    <button class="btn btn-primary dropdown-toggle" type="button" data-bs-toggle="dropdown">
                        <i class="fas fa-user me-1"></i>Profile
                    </button>
                    <ul class="dropdown-menu">
                        <li><a class="dropdown-item" href="employerProfile.html"><i class="fas fa-user me-2"></i>My Profile</a></li>
                        <li><hr class="dropdown-divider"></li>
                        <li><a class="dropdown-item" href="#" onclick="performLogout()"><i class="fas fa-sign-out-alt me-2"></i>Sign Out</a></li>
                    </ul>
                </div>
            </div>
        `;

        // Re-initialize dropdown functionality
        const dropdownElementList = [].slice.call(document.querySelectorAll('.dropdown-toggle'));
        const dropdownList = dropdownElementList.map(function (dropdownToggleEl) {
            return new bootstrap.Dropdown(dropdownToggleEl);
        });
    }

    // Logout function
    function performLogout() {
        sessionStorage.removeItem('authToken');
        sessionStorage.removeItem('userEmail');
        sessionStorage.removeItem('userRole');

        showNotification('Logged out successfully!', 'success');

        setTimeout(() => {
            window.location.href = 'main.html';
        }, 1000);
    }

    // Show notifications
    function showNotifications() {
        showNotification('Notifications feature coming soon!', 'info');
    }

    // Utility functions
    function formatDate(dateString) {
        const date = new Date(dateString);
        const now = new Date();
        const diffTime = Math.abs(now - date);
        const diffDays = Math.ceil(diffTime / (1000 * 60 * 60 * 24));

        if (diffDays === 1) return 'Posted Today';
        if (diffDays < 7) return `Posted ${diffDays} days ago`;
        if (diffDays < 30) return `Posted ${Math.ceil(diffDays / 7)} weeks ago`;
        return `Posted ${Math.ceil(diffDays / 30)} months ago`;
    }

    function formatJobType(jobType) {
        const types = {
            'FULLTIME': 'Full Time',
            'PARTTIME': 'Part Time',
            'INTERNSHIP': 'Internship',
            'CONTRACT': 'Contract',
            'REMOTE': 'Remote'
        };
        return types[jobType] || jobType;
    }

    function truncateText(text, maxLength) {
        if (!text) return '';
        if (text.length <= maxLength) return text;
        return text.substring(0, maxLength) + '...';
    }

    function debounce(func, wait) {
        let timeout;
        return function executedFunction(...args) {
            const later = () => {
                clearTimeout(timeout);
                func(...args);
            };
            clearTimeout(timeout);
            timeout = setTimeout(later, wait);
        };
    }

    function showNotification(message, type = 'info') {
        $('.notification-toast').remove();

        const alertClass = type === 'error' ? 'danger' : type;
        const iconClass = type === 'success' ? 'check-circle' : type === 'error' ? 'exclamation-circle' : 'info-circle';

        const toast = $(`
            <div class="alert alert-${alertClass} position-fixed notification-toast" style="top: 20px; right: 20px; z-index: 9999; min-width: 300px;">
                <div class="d-flex align-items-center">
                    <i class="fas fa-${iconClass} me-2"></i>
                    <span>${message}</span>
                    <button type="button" class="btn-close ms-auto" onclick="$(this).closest('.notification-toast').remove()"></button>
                </div>
            </div>
        `);

        $('body').append(toast);

        setTimeout(() => {
            toast.fadeOut(() => toast.remove());
        }, 5000);
    }
</script>
</body>
</html>